#!/usr/bin/env pebl2
##############################################################
## Test script for enhanced GetSubNum() function
## Tests multilingual support and automatic locale detection
##############################################################

define Start(lPar)
{
    gWin <- MakeWindow("grey")

    Print("=== GetSubNum() Enhanced Multilingual Test ===")
    Print("")

    # Show current language settings
    Print("Current gLanguage: [" + gLanguage + "]")
    systemLocale <- GetSystemLocale()
    Print("System locale: [" + systemLocale + "]")
    isRTL <- IsSystemLocaleRTL()
    Print("Is system locale RTL? " + isRTL)
    Print("")

    # Test GetSubNum() with current settings
    Print("Calling GetSubNum() - should use:")
    if(gLanguage != "")
    {
        Print("  -> gLanguage (" + gLanguage + ")")
    } else {
        if(systemLocale != "")
        {
            systemLang <- Uppercase(SubString(systemLocale, 1, 2))
            Print("  -> System locale (" + systemLang + ")")
        } else {
            Print("  -> English fallback")
        }
    }
    Print("")

    subnum <- GetSubNum(gWin)

    Print("---")
    Print("Participant ID entered: [" + subnum + "]")
    Print("")

    # Display results on screen
    gFont <- MakeFont(gPEBLBaseFont, 0, 24, MakeColor("black"), MakeColor("grey"), 1)

    y <- 250
    result <- MakeLabel("Participant ID: " + subnum, gFont)
    AddObject(result, gWin)
    Move(result, gVideoWidth/2, y)

    y <- y + 50
    langInfo <- MakeLabel("Language: " + gLanguage + " | Locale: " + systemLocale, gFont)
    AddObject(langInfo, gWin)
    Move(langInfo, gVideoWidth/2, y)

    y <- y + 80
    instruction <- MakeLabel("Press any key to exit", gFont)
    AddObject(instruction, gWin)
    Move(instruction, gVideoWidth/2, y)

    Draw()
    WaitForAnyKeyPress()

    Print("Test complete.")
}
